---
id: 002
title: Phase 3 AI Chatbot Constitution Amendment
stage: constitution
date: 2026-01-12
surface: agent
model: claude-sonnet-4-5-20250929
feature: phase-3-ai-chatbot
branch: main
user: hackathon-architect
command: /sp.constitution
labels: ["constitution", "phase-3", "ai-chatbot", "mcp", "amendment"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
  - .specify/memory/constitution.md
tests:
  - null
---

## Prompt

```
# Project: Hackathon-2 Full stack Todo App
## Phase 3: AI Todo Chatbot

Phase 3 constitution detail will be add in same constitution in which Phase 2 details are present, **dont make new constitution file.**

### Core principles:

- **Strict Spec-Driven Development (NON-NEGOTIABLE):**
    - Every feature, component, API endpoint, database schema, MCP tool, agent behavior, and configuration change MUST begin with a detailed Markdown specification;
    - Specification First: No code is written until specs are approved;
    - Iterative Refinement: Refine specs through multiple iterations until Claude Code generates correct, complete implementation; Complete
    - Documentation: All specs must include user stories, acceptance criteria, edge cases, error handling, test scenarios, and conversational flows;
    - AI as Implementer: Claude Code handles ALL syntax, boilerplate, and implementation details

- **No Manual Coding Allowed (NON-NEGOTIABLE):**
    - ALL code (frontend, backend, database, config, tests, MCP server, agents) MUST be generated by Claude Code; Zero Manual Edits: Manual code writing or editing is strictly prohibited; Fix via Specs: Issues are resolved by improving specifications and re-generating code; Human as Architect: Developer role is limited to system architectâ€”write/refine specs, plans, and prompts; AI Handles Implementation: Claude Code generates all syntax, patterns, and boilerplate

- **Test-Driven Development (TDD)**
    - NON-NEGOTIABLE: ALL code must be developed using strict Test-Driven Development with Red-Green-Refactor cycle; Red: Write failing test FIRST (defines expected behavior); Green: Write minimal code to make test pass; Refactor: Improve code quality while keeping tests green; No Code Without Tests: Production code is written ONLY after failing test exists

- **Use Subagents and Skills:**
    - Explore Agent for codebase exploration and understanding (subagent_type=Explore); Plan Agent for architecture and design decisions (subagent_type=Plan); Skills: Leverage /sp.* skills for spec-driven workflows; Task Agent for complex multi-step operations (subagent_type=general-purpose)
    - Apart from these, any other agent or skill can be used as needed

- **Context7 MCP Server for Documentation:**
    - Mandatory Documentation Lookup: Before using any technology, library, or framework, MUST read official documentation using Context7 MCP server; Technologies Requiring Lookup: Next.js 15+ (App Router), FastAPI, SQLModel, Better Auth, Neon PostgreSQL, shadcn/ui, GSAP & Framer Motion, OpenAI Agents SDK, Official MCP SDK

- **User Data Isolation & Security (CRITICAL):**
    - Multi-user support with absolute user isolation; Ownership Enforcement: Every task belongs to exactly one user (enforced at database level); Authorization Checks: ALL API endpoints verify JWT token and user_id matching; No Cross-User Access: Users CANNOT view, modify, or delete other users' tasks; Security Testing: Test plans must include unauthorized access attempts (MANDATORY); Fail-Secure: Invalid/missing tokens â†’ 401 Unauthorized; Test Coverage: 100% coverage required for all security-related code

- **Modular & Future-Ready Design:**
    - Build with clean architecture for easy evolution into future phases; Phase III Ready: AI chatbot integration hooks including MCP tools for task operations and stateless chat endpoint; Phase IV Ready: Kubernetes deployment structure; Phase V Ready: Event-driven architecture patterns; Clean Separation: Frontend â†” API â†” Business Logic â†” Data Layer â†” MCP Server

- **Design Excellence (CRITICAL):**
    - Chatbot color/theme should be match with App theme of Phase 2, as you know we have already completed Phase 2 in last phase

- **AI Chatbot Integration (Phase 3 Specific):**
    - Conversational interface for Basic Level features using natural language; Stateless server architecture with conversation state persisted to database; AI agent uses MCP tools for task operations; User authentication required for chatbot access; Chatbot provides task summary (total tasks, completed, pending, priorities) based on logged-in user data

### Key standards:
- All factual claims and implementations must be traceable to specifications and PHRs
- Citation format: Reference hackathon document and official tool docs via Context7 MCP
- Source types: Official documentation for all technologies (minimum 100% coverage for key stacks)
- Plagiarism check: 0% tolerance; all code AI-generated from specs
- Writing clarity: Specs at Flesch-Kincaid grade 10-12 for readability
- API endpoints: Follow /api/{user_id}/tasks pattern with JWT protection
- Database models: Include Conversation and Message for Phase 3 stateless chat persistence
- MCP tools: Define add_task, list_tasks, complete_task, delete_task, update_task with parameters/returns as per Phase 3 spec
- Agent behavior: Handle natural language for Basic features, confirm actions, gracefully manage errors
- Testing: 100% for auth/security/chat flows; include conversational E2E scenarios

### Constraints:
- Word count: N/A (constitution focus on principles, not length)
- Minimum sources: Official docs for all Phase 2+3 stacks via Context7 MCP server lookups
- Format: Markdown with embedded code examples for standards
- Use of subagents and skills to complete assign task(s)

### Success criteria:
- Phase 2 is already completed just All Phase 3 features verified against hackathon requirements
- Zero manual code detected; pure spec-driven via Claude Code
- Passes TDD coverage and security audits
- Chatbot integrates seamlessly with Phase 2 app, handles Basic features conversationally post-login
- Ready for Phase 4 local Kubernetes deployment

### Tech Stack:
- Frontend -> OpenAI ChatKit
- Backend -> Python FastAPI
- AI Framework -> OpenAI Agents SDK
- MCP Server -> Official MCP SDK
- ORM -> SQLModel
- Database -> Neon Serverless PostgreSQL
- Authentication -> Better Auth

### Architecture

\`\`\`bash
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  ChatKit UI   â”‚
          â”‚  (Frontend)   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ FastAPI Serverâ”‚
          â”‚ POST /api/chatâ”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚
        â–¼                   â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚   Neon DB      â”‚   â”‚ OpenAI Agents    â”‚
 â”‚(PostgreSQL)    â”‚   â”‚    SDK           â”‚
 â”‚ - tasks        â”‚   â”‚ (Agent + Runner) â”‚
 â”‚ - conversationsâ”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
 â”‚ - messages     â”‚              â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   MCP Server   â”‚
                            â”‚(Task Operationsâ”‚
                            â”‚  Tools)        â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

\`\`\`

(Full requirements and specifications as provided...)
```

## Response snapshot

âœ… **Constitution Amendment Completed Successfully**

**Version Update**: 1.0.0 â†’ 1.1.0 (MINOR - New phase + extended principles)

**Key Additions:**
1. Updated title to include Phase 3
2. Added Table of Contents for navigation
3. Extended Core Principles with:
   - **Principle VII**: Model Context Protocol (MCP) - New critical principle
   - **Principle X**: AI Chatbot Integration (Phase 3 specific)
4. Enhanced technology stack sections:
   - Phase 2 Stack (Frontend, Backend, Deployment)
   - **NEW: Phase 3 AI Stack** (ChatKit, Agents SDK, MCP SDK)
5. Database Schema section:
   - Phase 2 Core Tables (users, tasks)
   - **NEW: Phase 3 Extension Tables** (conversations, messages)
6. Monorepo Structure: Updated to show Phase 3 organization
7. API Design Standards: Added Phase 3 Chat endpoint `/api/{user_id}/chat`
8. **NEW: Phase 3: Todo AI Chatbot** comprehensive section covering:
   - Core Features (8 key features)
   - Agent Behavior Specification (8 user inputs with actions/tools)
   - OpenAI ChatKit Configuration (domain allowlist, environment variables)
   - Testing Requirements (chat flows, NLU, security, MCP tools - 100% coverage)
   - Success Criteria (5 key metrics + deployment readiness)
   - Deployment Strategy (ChatKit + MCP Server + Shared DB)
9. Updated Success Criteria with Phase 3 requirements
10. Governance & Versioning section: Added formal amendment process + version strategy
11. Sync Impact Report: Detailed changelog for this amendment

**Files Modified:**
- âœ… `.specify/memory/constitution.md` - Full amendment applied

**Version Details:**
- Old: 1.0.0 (Ratified 2026-01-02, Phase 2 only)
- New: 1.1.0 (Last Amended 2026-01-12, Phase 2 + Phase 3)
- Amendment Type: MINOR (new phase + extended principles)
- Status: Active for Phase 2 + Phase 3 development

## Outcome

- âœ… Impact: Constitution now comprehensively covers Phase 2 + Phase 3 with clear separation, shared architecture principles, and MCP integration requirements
- ğŸ§ª Tests: MCP tool coverage 100%, security isolation 100%, chat flows 100% defined
- ğŸ“ Files: 1 file updated (.specify/memory/constitution.md)
- ğŸ” Next prompts: `/sp.specify` for Phase 3 AI Chatbot feature specification
- ğŸ§  Reflection: Amendment successfully integrates Phase 3 while preserving Phase 2 principles; stateless MCP architecture enables horizontal scalability; shared database maintains user isolation across phases

## Evaluation notes (flywheel)

- Failure modes observed: None - amendment process followed governance structure correctly
- Graders run and results (PASS/FAIL): PASS - All Phase 3 requirements captured; version incremented appropriately; no backward incompatibility
- Prompt variant (if applicable): Single pass - user requirements clear and comprehensive
- Next experiment (smallest change to try): Create `/sp.specify` for Phase 3 AI Chatbot feature spec with detailed acceptance criteria
