# Hackathon II Phase 2: Todo Full-Stack Web Application Constitution

**Project**: Multi-user Full-Stack Todo Web Application
**Phase**: Phase 2 of 5 (Full-Stack Web Application)
**Development Methodology**: Strict Spec-Driven Development (SDD) with Claude Code + Spec-Kit Plus

---

## Core Principles

### I. Strict Spec-Driven Development (NON-NEGOTIABLE)

Every feature, component, API endpoint, database schema, and configuration change MUST begin with a detailed Markdown specification:

- **Specification First**: No code is written until specs are approved
- **Iterative Refinement**: Refine specs through multiple iterations until Claude Code generates correct, complete implementation
- **Complete Documentation**: All specs must include user stories, acceptance criteria, edge cases, error handling, and test scenarios
- **AI as Implementer**: Claude Code handles ALL syntax, boilerplate, and implementation details

**Workflow**: `/sp.specify → /sp.clarify → /sp.plan → /sp.tasks → /sp.analyze → /sp.implement`

### II. No Manual Coding Allowed (NON-NEGOTIABLE)

ALL code (frontend, backend, database, config, tests) MUST be generated by Claude Code:

- **Zero Manual Edits**: Manual code writing or editing is strictly prohibited
- **Fix via Specs**: Issues are resolved by improving specifications and re-generating code
- **Human as Architect**: Developer role is limited to system architect—write/refine specs, plans, and prompts
- **AI Handles Implementation**: Claude Code generates all syntax, patterns, and boilerplate

**Rationale**: Ensures consistency, maintainability, and demonstrates pure spec-driven methodology for hackathon judging.

### III. Test-Driven Development (TDD) - NON-NEGOTIABLE

ALL code must be developed using strict Test-Driven Development with Red-Green-Refactor cycle:

- **Red**: Write failing test FIRST (defines expected behavior)
- **Green**: Write minimal code to make test pass
- **Refactor**: Improve code quality while keeping tests green
- **No Code Without Tests**: Production code is written ONLY after failing test exists

**TDD Workflow**: `/sp.specify → /sp.plan → /sp.tasks → /sp.red → /sp.green → /sp.refactor`

**Testing Requirements:**
- **Backend**: 80%+ overall coverage, 100% for authentication and security
- **Frontend**: 70%+ overall coverage, 90%+ for critical components
- **E2E**: 100% coverage for critical user flows
- **Security Tests**: MANDATORY (user isolation, SQL injection, XSS)

**Test Specifications**: See `@specs/testing/` for complete testing requirements

### IV. Use Subagents and Skills

- **Explore Agent**: Use for codebase exploration and understanding (`subagent_type=Explore`)
- **Plan Agent**: Use for architecture and design decisions (`subagent_type=Plan`)
- **Skills**: Leverage `/sp.*` skills for spec-driven workflows
- **Task Agent**: Use for complex multi-step operations (`subagent_type=general-purpose`)

### V. Context7 MCP Server for Documentation

- **Mandatory Documentation Lookup**: Before using any technology, library, or framework, MUST read official documentation using Context7 MCP server
- **Technologies Requiring Lookup**:
  - Next.js 15+ (App Router)
  - FastAPI
  - SQLModel
  - Better Auth
  - Neon PostgreSQL
  - shadcn/ui
  - GSAP & Framer Motion
- **Pattern**: `mcp__context7__resolve-library-id` → `mcp__context7__query-docs`

### VI. User Data Isolation & Security (CRITICAL)

Multi-user support with absolute user isolation:

- **Ownership Enforcement**: Every task belongs to exactly one user (enforced at database level)
- **Authorization Checks**: ALL API endpoints verify JWT token and user_id matching
- **No Cross-User Access**: Users CANNOT view, modify, or delete other users' tasks
- **Security Testing**: Test plans must include unauthorized access attempts (MANDATORY)
- **Fail-Secure**: Invalid/missing tokens → 401 Unauthorized
- **Test Coverage**: 100% coverage required for all security-related code

### VII. Modular & Future-Ready Design

Build with clean architecture for easy evolution into future phases:

- **Phase III Ready**: AI chatbot integration hooks
- **Phase IV Ready**: Kubernetes deployment structure
- **Phase V Ready**: Event-driven architecture patterns
- **Clean Separation**: Frontend ↔ API ↔ Business Logic ↔ Data Layer
- **Versioned APIs**: API versioning strategy for backward compatibility

### VIII. Design Excellence (CRITICAL)

**Dashboard-Like Experience**: Build a modern, professional dashboard interface with fantastic UX that rivals premium SaaS applications.

**UI/UX Requirements**:
- **Dashboard Layout**: Sidebar navigation, main content area with cards/panels, header with user profile
- **Visual Hierarchy**: Clear information architecture with proper spacing, grouping, and visual weight
- **Typography**: Use `JetBrains Mono` (code/monospace) and `Inter` (body text) fonts for premium feel
- **Glassmorphism**: Apply backdrop-blur effects for depth, layering, and modern aesthetic
- **Component Library**: Use shadcn/ui for consistent, accessible, production-ready components
- **No Inline Styles**: ALL styling via Tailwind CSS classes (maintainability and consistency)
- **Smooth Animations**: GSAP and Framer Motion for delightful micro-interactions and page transitions
- **Responsive Design**: Mobile-first approach with seamless breakpoints for tablet/desktop
- **Dark Mode Support**: Toggle between light/dark themes with smooth transitions
- **Interactive Feedback**: Hover states, loading skeletons, toast notifications, confirmation modals
- **Data Visualization**: Progress indicators, task completion stats, priority distributions
- **Intuitive Navigation**: Keyboard shortcuts, breadcrumbs, search with instant results
- **Performance**: 60fps animations, optimized images, lazy loading, minimal layout shifts

**UX Excellence Standards**:
- Every interaction should feel instant and responsive
- Zero confusion - users should intuitively understand how to complete tasks
- Delight users with subtle animations and polished details
- Accessibility first - WCAG 2.1 AA compliance minimum
- Error states that guide users to resolution
- Empty states that encourage action

**UI/UX Specifications**: See `@specs/ui/` for comprehensive design system documentation:
- `@specs/ui/design-system.md` - Complete design tokens (colors, typography, spacing, shadows, glassmorphism)
- `@specs/ui/dashboard-layout.md` - Layout structure for desktop, tablet, mobile (sidebar, header, content)
- `@specs/ui/glassmorphism.md` - Glassmorphism patterns and implementation (backdrop-blur, layering, depth)
- `@specs/ui/animations.md` - GSAP & Framer Motion specifications (60fps micro-interactions, transitions)
- `@specs/ui/responsive-design.md` - Mobile-first responsive patterns (breakpoints, touch targets, adaptive layouts)
- `@specs/ui/dark-mode.md` - Theme toggle implementation (next-themes, color variables, smooth transitions)
- `@specs/ui/accessibility.md` - WCAG 2.1 AA compliance (keyboard nav, screen readers, ARIA, color contrast)

---

## Technology Stack

### Frontend
- **Framework**: Next.js 15+ with App Router
- **Language**: TypeScript (strict mode)
- **Styling**: Tailwind CSS (no inline styles)
- **Components**: shadcn/ui
- **Animations**: GSAP + Framer Motion
- **Fonts**: JetBrains Mono, Inter
- **Design**: Glassmorphism (backdrop-blur effects)

### Backend
- **Language**: Python 3.13+
- **Package Manager**: UV
- **Framework**: FastAPI
- **ORM**: SQLModel
- **Database**: Neon Serverless PostgreSQL
- **Authentication**: Better Auth with JWT tokens

### Development Tools
- **AI Development**: Claude Code (Sonnet 4.5)
- **Spec Framework**: Spec-Kit Plus
- **Version Control**: Git
- **Environment**: WSL 2 (for Windows users)

### Deployment
- **Frontend**: Vercel or GitHub Pages
- **Backend**: Hugging Face Spaces
- **Database**: Neon (serverless PostgreSQL)

---

## API Design Standards

### Base URL Structure
All API endpoints follow user-scoped pattern:
```
/api/{user_id}/...
```

### Required Endpoints

| Method | Endpoint | Description | Auth Required |
|--------|----------|-------------|---------------|
| GET | `/api/{user_id}/tasks` | List user's tasks (with filters/sort) | ✓ |
| POST | `/api/{user_id}/tasks` | Create new task | ✓ |
| GET | `/api/{user_id}/tasks/{id}` | Get task details | ✓ |
| PUT | `/api/{user_id}/tasks/{id}` | Update task | ✓ |
| DELETE | `/api/{user_id}/tasks/{id}` | Delete task | ✓ |
| PATCH | `/api/{user_id}/tasks/{id}/complete` | Toggle completion | ✓ |

### Authentication Flow
1. **JWT Tokens**: Better Auth configured for JWT issuance
2. **Token Secret**: Shared secret via `BETTER_AUTH_SECRET` env var
3. **Authorization Header**: `Authorization: Bearer <token>`
4. **Token Verification**: Backend middleware validates JWT on every request
5. **User ID Enforcement**: Middleware extracts `user_id` from token, verifies match with URL param
6. **Token Expiry**: 7 days (configurable)
7. **Unauthorized Response**: 401 with clear error message

---

## Feature Implementation Levels

### Level 1: Basic CRUD (Foundation)
- **Add Task**: Create with title and description
- **View Tasks**: List all user's tasks
- **Update Task**: Modify title/description
- **Delete Task**: Remove task (with confirmation)
- **Mark Complete**: Toggle task completion status

### Level 2: Intermediate Features (Organization)
- **Priority Levels**: HIGH (Red), MEDIUM (Yellow), LOW (Green), NONE
- **Tags/Categories**: Multi-tag support (comma-separated, max 20 chars each)
- **Search**: Keyword search across title/description (case-insensitive)
- **Filter**: By status (todo/done), priority, or tags (ANY-match logic)
- **Sort**: By Priority, Created Date, Title, or Due Date (with secondary sorting)

### Level 3: Advanced Features (Intelligence)
- **Recurring Tasks**: DAILY, WEEKLY, MONTHLY patterns
  - Auto-reschedule on completion or due date passage
  - Edge case handling (Feb 29, month-end dates)
- **Due Dates & Times**: DateTime precision (YYYY-MM-DD HH:MM)
  - Future validation
  - Browser notifications for due-soon tasks
- **Smart Reminders**:
  - Overdue detection (tasks past due datetime)
  - Due Soon alerts (within 60 minutes)
  - Browser notification API integration

---

## Monorepo Structure

```
Phase02_FullStackWebApp/
├── .specify/                    # Spec-Kit Plus framework
│   ├── config.yaml             # Monorepo configuration
│   ├── memory/
│   │   └── constitution.md     # This file
│   ├── templates/              # Spec templates
│   └── scripts/                # Automation scripts
├── specs/                      # Feature specifications
│   ├── authentication/
│   │   ├── spec.md
│   │   ├── plan.md
│   │   └── tasks.md
│   ├── basic-crud/
│   ├── intermediate-features/
│   └── advanced-features/
├── history/
│   ├── prompts/                # PHRs organized by feature
│   └── adr/                    # Architecture Decision Records
├── frontend/                   # Next.js application
│   ├── CLAUDE.md              # Frontend-specific guidelines
│   ├── app/                   # App Router pages
│   ├── components/            # React components
│   ├── lib/                   # Utilities
│   ├── public/                # Static assets
│   └── package.json
├── backend/                    # FastAPI application
│   ├── CLAUDE.md              # Backend-specific guidelines
│   ├── app/
│   │   ├── main.py           # FastAPI entry point
│   │   ├── models/           # SQLModel models
│   │   ├── routes/           # API endpoints
│   │   ├── services/         # Business logic
│   │   └── middleware/       # Auth, CORS, etc.
│   ├── tests/
│   └── pyproject.toml
├── CLAUDE.md                   # Root guidelines
└── README.md                   # Project documentation
```

---

## Authentication & Security Standards

### JWT Token Implementation
- **Library**: Better Auth (configured for JWT)
- **Secret Management**: `BETTER_AUTH_SECRET` environment variable (never committed)
- **Token Payload**: Must include `user_id`, `email`, `exp` (expiry), `iat` (issued at)
- **Token Storage**: HttpOnly cookies (frontend) or localStorage (with XSS precautions)
- **Token Expiry**: 7 days (refresh tokens optional for Phase 3)

### Security Requirements
1. **Password Hashing**: bcrypt or argon2 (via Better Auth)
2. **SQL Injection Prevention**: SQLModel parameterized queries only
3. **XSS Protection**: Input sanitization, Content-Security-Policy headers
4. **CORS Configuration**: Restrict origins (localhost for dev, production domains for deploy)
5. **Rate Limiting**: 100 requests/minute per user (prevent abuse)
6. **Error Messages**: Never expose sensitive details (DB structure, stack traces)

### User Isolation Tests (Required)
- Attempt to access `/api/{other_user_id}/tasks` with valid but different user token → 401
- Attempt to modify `/api/{other_user_id}/tasks/{id}` → 401
- Token expiry verification (7 days + 1 minute) → 401
- Invalid/malformed token → 401
- Missing Authorization header → 401

---

## Code Quality Standards

### TypeScript (Frontend)
- **Strict Mode**: `"strict": true` in tsconfig.json
- **No Any**: Avoid `any` type; use `unknown` or proper types
- **Interfaces**: Define interfaces for all props, API responses, state
- **Error Handling**: Typed error boundaries and try-catch blocks

### Python (Backend)
- **Type Hints**: 100% coverage (Mypy strict mode)
- **Pydantic**: Use for request/response validation
- **SQLModel**: Type-safe ORM queries
- **Ruff**: Linting + formatting (auto-fix on save)

### Testing Requirements (TDD - MANDATORY)

**Test-Driven Development Process:**
1. **Red**: Write failing test first
2. **Green**: Write minimal code to pass test
3. **Refactor**: Improve code while keeping tests green

**Backend Testing (pytest):**
- **Unit Tests**: 80%+ overall coverage, 100% for auth/security
- **Integration Tests**: All API endpoints with auth scenarios
- **Security Tests**: User isolation, SQL injection, XSS (MANDATORY)
- **Performance Tests**: JWT verification < 10ms, Task list < 200ms
- **Test Specs**: See `@specs/testing/backend-testing.md`

**Frontend Testing (Vitest + React Testing Library):**
- **Component Tests**: 70%+ overall coverage, 90%+ for auth/task components
- **Unit Tests**: API client functions, utilities, hooks
- **Accessibility Tests**: Keyboard navigation, screen reader labels
- **Test Specs**: See `@specs/testing/frontend-testing.md`

**E2E Testing (Playwright):**
- **Critical Flows**: 100% coverage (signup, login, create task, complete, logout)
- **Cross-Browser**: Chrome, Firefox, Safari
- **Performance**: Page load < 2s, task list load < 500ms
- **Test Specs**: See `@specs/testing/e2e-testing.md`

**Testing Philosophy**: See `@specs/testing/overview.md` for complete testing strategy

---

## Development Workflow

### Spec-Driven Iteration Cycle
```
1. /sp.specify    → Write feature specification
2. /sp.clarify    → Ask 2-5 targeted questions to eliminate ambiguity
3. /sp.plan       → Create architecture plan (tech decisions, API contracts)
4. /sp.tasks      → Break down into atomic, testable tasks
5. /sp.analyze    → Cross-check spec/plan/tasks for consistency
6. /sp.implement  → Generate code via Claude Code
7. Test & Verify  → Run tests, check security, validate UI
8. Iterate        → If issues found, refine spec (NOT code) and regenerate
```

### Prompt History Records (PHRs)
- **Creation**: After EVERY user interaction (automatic)
- **Location**: `history/prompts/{feature-name}/`
- **Naming**: `{ID}-{slug}.{stage}.prompt.md`
- **Required Fields**: ID, title, stage, date, user input (verbatim), AI response

### Architecture Decision Records (ADRs)
- **Trigger**: Significant architectural decisions (framework choice, auth strategy, DB schema)
- **Process**: Suggest ADR creation; wait for user consent
- **Location**: `history/adr/`
- **Template**: Use `.specify/templates/adr-template.md`

---

## Constraints

### Prohibited Actions
- ❌ Manual code writing or editing
- ❌ Inline styles (use Tailwind classes only)
- ❌ Hardcoded secrets (use environment variables)
- ❌ Refactoring unrelated code
- ❌ Skipping spec/plan/tasks stages

### Required Actions
- ✅ Use Context7 MCP for tech documentation
- ✅ Create PHRs for all interactions
- ✅ Write specs BEFORE code generation
- ✅ Test user isolation security
- ✅ Deploy to Vercel/Hugging Face

### Platform Requirements
- **Windows Users**: MUST develop in WSL 2
- **Local Development**: docker-compose or separate dev servers
- **Environment Files**: `.env.local` (frontend), `.env` (backend) with templates in repo

---

## Success Criteria

### Functional Requirements
- ✅ Fully working multi-user web app
- ✅ All Basic, Intermediate, and Advanced features implemented
- ✅ Secure authentication with JWT
- ✅ Persistent storage in Neon PostgreSQL
- ✅ Responsive UI with animations
- ✅ Browser notifications for reminders

### Security Requirements
- ✅ User isolation verified (no cross-user access)
- ✅ JWT token validation on all protected endpoints
- ✅ Unauthorized requests return 401
- ✅ Passwords hashed (never stored plaintext)
- ✅ SQL injection prevented (parameterized queries)

### Documentation Requirements
- ✅ Complete specs folder with refinement history
- ✅ PHRs demonstrating spec-driven process
- ✅ ADRs for major architectural decisions
- ✅ README with setup instructions
- ✅ API documentation (OpenAPI/Swagger)

### Deployment Requirements
- ✅ Frontend deployed to Vercel or GitHub Pages
- ✅ Backend API deployed to Hugging Face Spaces
- ✅ Database hosted on Neon (serverless PostgreSQL)
- ✅ Environment variables configured in deployment platforms
- ✅ Live demo URL accessible

### Hackathon Judging Criteria
- ✅ Clear evidence of spec-driven process (specs, PHRs, iterations)
- ✅ No manual code editing (all AI-generated)
- ✅ Security best practices demonstrated
- ✅ Modern, polished UI/UX
- ✅ Ready for Phase III progression (AI chatbot integration)

---

## Governance

This constitution supersedes all other development practices and guidelines. ALL team members (human architects and AI agents) MUST adhere to these principles.

**Amendments**:
- Require documentation in ADR
- Must have clear rationale (not convenience)
- Need explicit user approval
- Include migration plan for existing code/specs

**Enforcement**:
- All PRs/reviews verify compliance
- Complexity/exceptions require justification
- Use `CLAUDE.md` files (root, frontend, backend) for runtime development guidance

---

**Version**: 1.0.0
**Ratified**: 2026-01-02
**Last Amended**: 2026-01-02
**Next Review**: Before Phase III initiation
